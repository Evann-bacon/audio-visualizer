<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ferrari Visualizer</title>

<style>
body{
  margin:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
}

canvas{
  position:absolute;
}

#album{
  width:220px;
  height:220px;
  border-radius:50%;
  object-fit:cover;
  position:absolute;
  z-index:2;
  cursor:pointer;
  transition: box-shadow 0.3s ease;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>
<img id="album" src="car.png">
<audio id="audio" src="music.mp3"></audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const audio = document.getElementById("audio");
const album = document.getElementById("album");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

const baseRadius = 130;
const lines = 200;

let time = 0;
let animationId = null;
let isAnimating = false;
let opacity = 1;
let fadingOut = false;

function draw(){
  if(!isAnimating) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  const cx = canvas.width/2;
  const cy = canvas.height/2;

  ctx.save();
  ctx.globalAlpha = opacity;

  for(let i=0;i<lines;i++){
    const angle = (i/lines)*Math.PI*2;
    const wave = Math.sin(angle*6 + time);

    const inner = baseRadius + wave*4;
    const outer = baseRadius + 10 + wave*6;

    const x1 = cx + Math.cos(angle)*inner;
    const y1 = cy + Math.sin(angle)*inner;

    const x2 = cx + Math.cos(angle)*outer;
    const y2 = cy + Math.sin(angle)*outer;

    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);

    ctx.strokeStyle = "#ff1a1a";
    ctx.lineWidth = 1.5;

    // ðŸ”¥ Ferrari glow
    ctx.shadowBlur = 15;
    ctx.shadowColor = "#ff0000";

    ctx.stroke();
  }

  ctx.restore();

  time += 0.04;

  // ðŸŒ« Smooth fade out
  if(fadingOut){
    opacity -= 0.03;
    if(opacity <= 0){
      opacity = 0;
      stopFully();
      return;
    }
  }

  animationId = requestAnimationFrame(draw);
}

function startWaves(){
  if(isAnimating) return;
  isAnimating = true;
  fadingOut = false;
  opacity = 1;
  album.style.boxShadow = "0 0 25px #ff0000";
  draw();
}

function stopWaves(){
  fadingOut = true;
  album.style.boxShadow = "0 0 0px #ff0000";
}

function stopFully(){
  isAnimating = false;
  fadingOut = false;

  if(animationId){
    cancelAnimationFrame(animationId);
    animationId = null;
  }

  ctx.clearRect(0,0,canvas.width,canvas.height);
}

album.addEventListener("click", ()=>{
  if(audio.paused){
    audio.play();
  } else {
    audio.pause();
  }
});

audio.addEventListener("play", startWaves);
audio.addEventListener("pause", stopWaves);
audio.addEventListener("ended", stopWaves);

</script>

</body>
</html>
